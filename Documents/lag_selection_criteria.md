# ラグ次数の選択基準について

## はじめに

時系列データの分析において、適切なラグ次数（過去のデータをどれだけ考慮するか）を選択することは非常に重要です。このドキュメントでは、ラグ次数を選択する際の 3 つの主要な基準について解説します。

## 1. AIC（赤池情報量基準）

### 基本概念

AIC（Akaike Information Criterion）は、モデルの予測精度と複雑さのバランスを評価する基準です。

### 計算方法

```
AIC = -2 × 対数尤度 + 2 × パラメータ数
```

### 特徴

- **小さいほど良い**：AIC の値が小さいほど、そのモデルが良いと判断されます
- **過学習を防ぐ**：パラメータ数（ラグ次数）が増えると、ペナルティが大きくなります
- **予測精度重視**：モデルの予測性能を重視します

### 使用シーン

- 予測を主な目的とする場合
- データ数が比較的少ない場合
- モデルの複雑さを抑えたい場合

## 2. BIC（ベイズ情報量基準）

### 基本概念

BIC（Bayesian Information Criterion）は、AIC と同様にモデルの適合度を評価しますが、サンプルサイズも考慮に入れます。

### 計算方法

```
BIC = -2 × 対数尤度 + log(サンプルサイズ) × パラメータ数
```

### 特徴

- **小さいほど良い**：BIC の値が小さいほど、そのモデルが良いと判断されます
- **より厳しいペナルティ**：AIC よりもパラメータ数に対するペナルティが大きい
- **真のモデルへの収束**：サンプルサイズが大きくなるにつれて、真のモデルを選択する確率が高くなります

### 使用シーン

- データ数が十分に大きい場合
- 真のモデル構造を特定したい場合
- より単純なモデルを好む場合

## 3. 交差検証（Cross Validation）

### 基本概念

交差検証は、データを複数のグループに分け、一部のデータでモデルを学習し、残りのデータで検証する方法です。

### 時系列データでの交差検証

時系列データでは、時間の順序を保持する必要があるため、通常の交差検証とは異なる方法を使用します：

1. **時系列分割交差検証**：
   - データを時間順に複数のセグメントに分割
   - 過去のデータで学習し、未来のデータで検証
   - 各セグメントで MSE（平均二乗誤差）を計算

### 特徴

- **実践的な評価**：実際の予測性能を直接評価できます
- **過学習の検出**：モデルが過学習していないかを確認できます
- **データの有効活用**：限られたデータを効率的に使用できます

### 使用シーン

- 予測精度を最も重視する場合
- 実務的な予測モデルを構築する場合
- モデルの汎化性能を確認したい場合

## 各基準の使い分け

### AIC を選ぶ場合

- 予測を主な目的とする
- データ数が比較的少ない
- モデルの複雑さを適度に抑えたい

### BIC を選ぶ場合

- データ数が十分に大きい
- 真のモデル構造を特定したい
- より単純なモデルを好む

### 交差検証を選ぶ場合

- 実践的な予測性能を重視する
- モデルの汎化性能を確認したい
- 過学習のリスクを最小限に抑えたい

## 実践的なアドバイス

1. **複数の基準を試す**：

   - 異なる基準で結果を比較
   - 各基準の特徴を理解した上で選択

2. **ドメイン知識の活用**：

   - 理論的な知見がある場合は考慮
   - 実務的な制約がある場合は反映

3. **結果の解釈**：

   - 基準値だけでなく、モデルの実用性も考慮
   - 過度に複雑なモデルは避ける

4. **定期的な再評価**：
   - 新しいデータが得られたら再検討
   - モデルの性能を継続的にモニタリング

## まとめ

ラグ次数の選択は、分析の目的やデータの特性に応じて適切な基準を選択することが重要です。AIC、BIC、交差検証それぞれに特徴があり、状況に応じて使い分けることで、より適切なモデルを構築することができます。
